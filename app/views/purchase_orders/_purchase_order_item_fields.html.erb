<label class="hide"><%= f.hidden_field :id %></label>
<label class="hide"><%= f.hidden_field :product_id %></label>
<%= f.text_field :product_name       , :label => "Produto"           , :class => "autocomplete", :source => "product", :callback => "loadMeasureUnits()" %>
<%= f.text_field :quantity           , :label => "Quantidade"        %>
<%= f.select     :measure_unit_id, [], :label => "Unidade de medida" %>
<%= f.text_field :unit_value         , :label => "Valor unitÃ¡rio"    , :class => "mask-money"%>
<%= f.text_field :total_value        , :label => "Valor total"       , :disabled => "deisabled" %>
<%= f.text_field :delivery           , :label => "Data de entrega"   , :class => 'datepicker' %>

<div class="clear"></div>
<script type="text/javascript">
  var prefix = '#purchase_order_order_items_attributes_0_';
  var calcFields =      prefix+'quantity';
  calcFields    += ', '+prefix+'unit_value';
  $(calcFields).bind('change', function(){
    var x = $(prefix+'quantity'  ).val();
    var y = $(prefix+'unit_value').val();

    x = x.replace(',', '.');
    y = format.money.toNumber(y);
    var z = format.number.toMoney(x * y);

    $(prefix+'total_value').val(z);
  });
  
  var loadMeasureUnits = function() {
    var prod_id = $(prefix+"product_id").val();
    $.ajax({
      url: '/autocomplete/measure_units',
      data: 'prod_id=' + prod_id,
      type: 'GET',
      dataType: 'json',
      success: function(data){
        var opts = '';
        for (i = 0; i < data.length - 1; i++){
          var t = data[i];
          opts += '<option value="' + t.id + '">' + t.value + '</option>';
        };
        $(prefix+'measure_unit_id').html(opts);
      }
    });
  }

  $(prefix+"product_id").bind('change', loadMeasureUnits);
</script>

