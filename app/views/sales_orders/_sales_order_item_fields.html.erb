<label class="hide"><%= f.hidden_field :id %></label>
<label class="hide"><%= f.hidden_field :product_id %></label>
<%= f.text_field :product_name       , :label => "Produto"           , :size => 20, :class => "autocomplete", :source => "product", :callback => "loadMeasureUnits()" %>
<%= f.text_field :quantity           , :label => "Quantidade"        , :size => 20 %>
<%= f.select     :measure_unit_id, [], :label => "Unidade de medida" , :size => 20 %>
<%= f.text_field :unit_value         , :label => "Valor unitÃ¡rio"    , :size => 20 %>
<%= f.text_field :total_value        , :label => "Valor total"       , :size => 10, :disabled => "deisabled" %>
<%= f.text_field :delivery           , :label => "Data de entrega"   , :size => 10, :class => 'datepicker' %>

<div class="clear"></div>
<script type="text/javascript">

  var calcFields =   '#sales_order_order_items_attributes_0_quantity'
  calcFields    += ', #sales_order_order_items_attributes_0_unit_value'
  $(calcFields).bind('change', function(){
    var x = $('#sales_order_order_items_attributes_0_quantity'  ).val();
    var y = $('#sales_order_order_items_attributes_0_unit_value').val();

    x = x.replace(',', '.');
    y = y.replace(',', '.');
    var z = (x*y) + '';
    z = z.replace('.', ',');

    $('#sales_order_order_items_attributes_0_total_value').val(z);
  });
  
  var loadMeasureUnits = function() {
    var prod_id = $("#sales_order_order_items_attributes_0_product_id").val();
    $.ajax({
      url: '/autocomplete/measure_units',
      data: 'prod_id=' + prod_id,
      type: 'GET',
      dataType: 'json',
      success: function(data){
        var opts = '';
        for (i = 0; i < data.length - 1; i++){
          var t = data[i];
          opts += '<option value="' + t.id + '">' + t.value + '</option>';
        };
        $('#sales_order_order_items_attributes_0_measure_unit_id').html(opts);
      }
    });
  }

  $("#sales_order_order_items_attributes_0_product_id").bind('change', loadMeasureUnits);
</script>

